#!/bin/bash
XML_FILE=$1
XML_DIR="/home/troy/beerliberation/xml/review/beer/"

# Clean up the data (remove extraneous spaces, etc.)

# Do verification on the data

MY_DIR=`dirname $0`;

# Find a unique ID
BEER_ID=`xmlstarlet sel -t -v "/post/doc/beer_review/beer_id" $XML_FILE`;
USER_ID=`xmlstarlet sel -t -v "/post/cgi/cookies/userid" $XML_FILE`;

if [ ! -d $XML_DIR/$BEER_ID ]; then
	mkdir -p $XML_DIR/$BEER_ID;
fi

xmlstarlet tr $MY_DIR/xsl/beer_review.xsl -s ID=$ID $XML_FILE > $XML_DIR/$BEER_ID/$USER_ID.xml

echo "Content-Type: text/xml";
echo;
echo "<result>$XML_DIR/$BEER_ID/$USER_ID.xml</result>";

# Generate the HTML file
# WWWDOCROOT=$WWWDOCROOT WWWRELPATH=$WWWRELPATH make -C $HTML_DIR $ID.html

# Check the doc into SVN
